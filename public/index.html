<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contact Form</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Contact Form</h1>
    <p class="subtitle">Fill out the form below and we'll get back to you soon.</p>

    <div id="successMessage" class="success-message">
      <strong>Success!</strong> Your form has been submitted successfully.
    </div>

    <div id="errorList" class="error-list">
      <strong>Please fix the following errors:</strong>
      <ul id="errorItems"></ul>
    </div>

    <form id="contactForm" novalidate>
      <div class="form-group" id="nameGroup">
        <label for="name">
          Name <span class="required">*</span>
        </label>
        <input 
          type="text" 
          id="name" 
          name="name" 
          placeholder="Enter your full name"
        >
        <div class="error-message" id="nameError"></div>
      </div>

      <div class="form-group" id="emailGroup">
        <label for="email">
          Email <span class="required">*</span>
        </label>
        <input 
          type="email" 
          id="email" 
          name="email" 
          placeholder="your.email@example.com"
        >
        <div class="error-message" id="emailError"></div>
      </div>

      <div class="form-group" id="messageGroup">
        <label for="message">
          Message <span class="required">*</span>
        </label>
        <textarea 
          id="message" 
          name="message" 
          placeholder="Enter your message (minimum 20 characters)"
        ></textarea>
        <div class="error-message" id="messageError"></div>
      </div>

      <div class="form-group" id="attachmentGroup">
        <label for="attachment">
          Attachment <span style="color: #999; font-weight: normal;">(optional)</span>
        </label>
        <div class="file-input-wrapper">
          <input 
            type="file" 
            id="attachment" 
            name="attachment" 
            accept=".pdf,.jpg,.jpeg,.png"
          >
          <label for="attachment" class="file-input-label">
            ðŸ“Ž Choose a file or drag it here
          </label>
        </div>
        <div class="file-name" id="fileName"></div>
        <div class="file-info">Accepted formats: PDF, JPG, PNG â€¢ Max size: 5MB</div>
        <div class="error-message" id="attachmentError"></div>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">
        Submit Form
      </button>
    </form>
  </div>

  <script>
    const form = document.getElementById('contactForm');
    const submitBtn = document.getElementById('submitBtn');
    const successMessage = document.getElementById('successMessage');
    const errorList = document.getElementById('errorList');
    const errorItems = document.getElementById('errorItems');
    const fileInput = document.getElementById('attachment');
    const fileName = document.getElementById('fileName');

    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
        fileName.textContent = `Selected: ${file.name} (${fileSizeMB} MB)`;
        
        if (file.size > 5 * 1024 * 1024) {
          setError('attachmentGroup', 'attachmentError', 'File size must not exceed 5MB');
        } else {
          clearError('attachmentGroup', 'attachmentError');
        }
      } else {
        fileName.textContent = '';
      }
    });

    function validateForm() {
      let isValid = true;
      const errors = [];

      clearAllErrors();

      const name = document.getElementById('name').value.trim();
      if (!name) {
        setError('nameGroup', 'nameError', 'Name is required');
        errors.push('Name is required');
        isValid = false;
      }

      // Email validation
      const email = document.getElementById('email').value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!email) {
        setError('emailGroup', 'emailError', 'Email is required');
        errors.push('Email is required');
        isValid = false;
      } else if (!emailRegex.test(email)) {
        setError('emailGroup', 'emailError', 'Please enter a valid email address');
        errors.push('Please enter a valid email address');
        isValid = false;
      }

      // Message validation
      const message = document.getElementById('message').value.trim();
      if (!message) {
        setError('messageGroup', 'messageError', 'Message is required');
        errors.push('Message is required');
        isValid = false;
      } else if (message.length < 20) {
        setError('messageGroup', 'messageError', `Message must be at least 20 characters (currently ${message.length})`);
        errors.push('Message must be at least 20 characters');
        isValid = false;
      }

      // File validation
      const file = fileInput.files[0];
      if (file && file.size > 5 * 1024 * 1024) {
        setError('attachmentGroup', 'attachmentError', 'File size must not exceed 5MB');
        errors.push('File size must not exceed 5MB');
        isValid = false;
      }

      return { isValid, errors };
    }

    function setError(groupId, errorId, message) {
      const group = document.getElementById(groupId);
      const error = document.getElementById(errorId);
      group.classList.add('error');
      group.classList.remove('success');
      error.textContent = message;
    }

    function clearError(groupId, errorId) {
      const group = document.getElementById(groupId);
      const error = document.getElementById(errorId);
      group.classList.remove('error');
      error.textContent = '';
    }

    function clearAllErrors() {
      const groups = ['nameGroup', 'emailGroup', 'messageGroup', 'attachmentGroup'];
      const errors = ['nameError', 'emailError', 'messageError', 'attachmentError'];
      
      groups.forEach((groupId, index) => {
        clearError(groupId, errors[index]);
      });

      errorList.classList.remove('show');
      successMessage.classList.remove('show');
    }

    function showErrorList(errors) {
      errorItems.innerHTML = errors.map(err => `<li>${err}</li>`).join('');
      errorList.classList.add('show');
    }

    // Form submission
    form.addEventListener('submit', async function(e) {
      e.preventDefault();

      const validation = validateForm();
      
      if (!validation.isValid) {
        showErrorList(validation.errors);
        return;
      }

      // Show loading state
      submitBtn.disabled = true;
      submitBtn.classList.add('loading');
      submitBtn.textContent = 'Submitting';

      try {
        const formData = new FormData(form);

        const response = await fetch('/api/submit', {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (data.success) {
          successMessage.classList.add('show');
          
          ['nameGroup', 'emailGroup', 'messageGroup'].forEach(id => {
            document.getElementById(id).classList.add('success');
          });

          form.reset();
          fileName.textContent = '';
          window.scrollTo({ top: 0, behavior: 'smooth' });

          setTimeout(() => {
            ['nameGroup', 'emailGroup', 'messageGroup'].forEach(id => {
              document.getElementById(id).classList.remove('success');
            });
          }, 3000);

        } else {
          if (data.errors && data.errors.length > 0) {
            showErrorList(data.errors);
          }
        }

      } catch (error) {
        console.error('Error:', error);
        showErrorList(['An error occurred while submitting the form. Please try again.']);
      } finally {
        submitBtn.disabled = false;
        submitBtn.classList.remove('loading');
        submitBtn.textContent = 'Submit Form';
      }
    });

    ['name', 'email', 'message'].forEach(id => {
      document.getElementById(id).addEventListener('input', () => {
        successMessage.classList.remove('show');
      });
    });
  </script>
</body>
</html>